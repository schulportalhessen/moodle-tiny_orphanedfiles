{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Storage helper for the Moodle Tiny orphanedfiles plugin.\n *\n * @module     tiny_orphanedfiles/plugin\n * @copyright  2023 Andreas Siebel <andreas.siebel@schulportal.hessen.de>\n * @copyright  2023 Andreas Schenkel <andreas.schenkel@schulportal.hessen.de>\n * @author     2023 Andreas Siebel <andreas.siebel@schulportal.hessen.de>\n * @author     2023 Andreas Schenkel <andreas.schenkel@schulportal.hessen.de>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Config from 'core/config';\nimport OrphanedFilesManager from \"./orphanedfilesmanager\";\nimport {getContextId, getDraftItemId} from 'editor_tiny/options';\nimport {getShowReferencecountEnabled, getOrphanedFilesCounterOnly, getUserContextId} from \"./options\";\n\nexport const register = (editor) => {\n    // Main.js ist defined to be registerd in plugin.js.\n\n    // global variable to store orphanedfilesindicator\n    let orphanedfilesmanager = null;\n\n    editor.on('input', () => {\n        orphanedfilesmanager.update();\n    });\n\n    editor.on('Undo', () => {\n        orphanedfilesmanager.update();\n    });\n\n    editor.on('Redo', () => {\n        orphanedfilesmanager.update();\n    });\n\n    editor.on('focus', () => {\n        orphanedfilesmanager.update();\n    });\n\n    editor.on('init', () => {\n        const params = {\n            // We collect all configurations and information we need later like contextId, ...\n            wwwRoot: Config.wwwroot,\n            contextId: getContextId(editor),\n            draftItemId: getDraftItemId(editor),\n\n            // Collect more settings defined in options.js eg userContextId from moodle plugininfo\n            userContextId: getUserContextId(editor),\n            showReferenceCountEnabled: getShowReferencecountEnabled(editor),\n            orphanedFilesCounterOnly: getOrphanedFilesCounterOnly(editor),\n        };\n\n        orphanedfilesmanager = new OrphanedFilesManager(params, editor);\n        orphanedfilesmanager.createOrphanedArea();\n        orphanedfilesmanager.update();\n    });\n};"],"names":["editor","orphanedfilesmanager","on","update","params","wwwRoot","Config","wwwroot","contextId","draftItemId","userContextId","showReferenceCountEnabled","orphanedFilesCounterOnly","OrphanedFilesManager","createOrphanedArea"],"mappings":";;;;;;;;;;oNA+ByBA,aAIjBC,qBAAuB,KAE3BD,OAAOE,GAAG,SAAS,KACfD,qBAAqBE,YAGzBH,OAAOE,GAAG,QAAQ,KACdD,qBAAqBE,YAGzBH,OAAOE,GAAG,QAAQ,KACdD,qBAAqBE,YAGzBH,OAAOE,GAAG,SAAS,KACfD,qBAAqBE,YAGzBH,OAAOE,GAAG,QAAQ,WACRE,OAAS,CAEXC,QAASC,gBAAOC,QAChBC,WAAW,yBAAaR,QACxBS,aAAa,2BAAeT,QAG5BU,eAAe,8BAAiBV,QAChCW,2BAA2B,0CAA6BX,QACxDY,0BAA0B,yCAA4BZ,SAG1DC,qBAAuB,IAAIY,8BAAqBT,OAAQJ,QACxDC,qBAAqBa,qBACrBb,qBAAqBE"}